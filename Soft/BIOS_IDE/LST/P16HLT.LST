.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49
Table of contents

    2- 462	common definitions for bios monitor
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 1


      1					.enabl  lc
      2					.enabl	ama
      3					.enabl  gbl
      4					.mcall	.push,.pop
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 3
Common definitions for bios monitor

      2
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4
Common definitions for bios monitor

      1					.enabl	ama
      2		161663 			ver$$	= 343*400+263
      3		000015 			ser.No	= 13.
      4		001740 			m$siz	=1740
      5	000000				.ASECT
      6					;----------------------------------------
      7		000000 			.=0
      8	000000	000500 	000600 			.word	pw.init,600		;    100
      9		000004 			.=4					;    ===
     10	000004	002214 	000600 			.word	tr4h,	600		;10 I	I 200
     11		000010 			.=10					;   I 2 I
     12	000010	000000G	000600 			.word	fis,	600		;    ===
     13		000014 			.=14 					;   I	I
     14	000014	161663 	000015 			.word	ver$$,	ser.No		;20 I	I 1
     15										;    ===   * 4
     16					.iif gt .-40	.error ; не влазит !	;    40
     17					;----------------------------------------
     18		000060 			.=60
     19	000060	001414 	000000G	000000 	htbl:	.word	$$csr,$$kdc3,0,0,0,0,0,0
	000066	000000 	000000 	000000
	000074	000000 	000000
     20					;------------------------------------------------
     21	000100	   371 	   201 	   362 	dctbl:: .byte	371,201,362,343,213,153,173,301
	000103	   343 	   213 	   153
	000106	   173 	   301
     22	000110	   373 	   353 	   333 		.byte	373,353,333,073,170,263,172,132
	000113	   073 	   170 	   263
	000116	   172 	   132
     23					;------------------------------------------------
     24	000120				dvtbl:	;20. max
     25	000120	000200 				.word	dxtbl
     26	000122	161036 	161030 	161034 		.word	ppip,	ppia,	ppic
     27	000130	161016 	161012 	161062 		.word	sndcsr,	sndc1r,	dlcs,	kbdcsr,	piccsr,	picmr
	000136	161066 	161000 	161002
     28	000144	161026 	161034 	161412 		.word	snlcsr,	ppic,	161412,	161413,	ppic
	000152	161413 	161034
     29	000156	161214 	161210 	161204 		.word	hr6,	hr4,	hr2,	hr3
	000164	161206
     30
     31					;----------------------------------------
     32					.iif gt .-170	.error ; не влазит !
     33		000170 			.=170
     34	000170	001550 	000600 			.word	vhlt,	600	;HLT
     35		000174 			.=174
     36	000174	001446 	000601 			.word	vec.to, 601	;TO2
     37					;----------------------------------------
     38	000200				dxtbl:
     39	000200	   001 	   212 			.byte	1,	212
     40	000202	   001 	   340 			.byte	1, 	340
     41	000204	   001 	   015 			.byte	1, 	15
     42	000206	   001 	   126 			.byte	1,	126
     43	000210	   001 	   015 			.byte	1,	13.
     44	000212	   006 	   000 	   000 		.byte	6, 	0, 	0, 	0, 	100, 	316, 	5
	000215	   000 	   100 	   316
	000220	   005
     45	000221	   005 	   014 	   050 		.byte	5,	14, 	40+10, 	^B11010011, 340, 340
	000224	   323 	   340 	   340
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-1
Common definitions for bios monitor

     46	000227	   001 	   022 			.byte	1, 	22
     47	000231	   002 	   000 	   377 		.byte	2, 	0, 	377
     48	000234	   003 	   064 	   164 		.byte	3,	64, 	164, 	264
	000237	   264
     49	000240	   001 	   014 			.byte	1, 	14
     50	000242	   001 	   052 			.byte	1,	52
     51	000244	   001 	   016 			.byte	1,	16
     52	000246	   001 	   015 			.byte	1, 	15
     53	000250	   001 	   000 			.byte	1,	0
     54	000252	   001 	   040 			.byte	1,	40
     55	000254	   001 	   000 			.byte	1,	0
     56	000256	   001 	   000 			.byte	1,	0
     57					.even
     58	000260				.print
     59					.iif gt .-274	.error ; не влазит !
     60
     61					;--------------------------------------------------------
     62		000274 			.=274
     63	000274	001446 	000600 			.word	vec.to, 600	;VEC.TO
     64					;_______________0_______2_______4_______6_______10______12______14______16
     65	000300	000004 	001020 	000004 	vdtbl:: .word	4,   1020,	4, 125000,    460,    462,    464,    464
	000306	125000 	000460 	000462
	000314	000464 	000464
     66	000320	000466 	000470 	000472 		.word 466,    470,    472,    472,    474
	000326	000472 	000474
     67	000332	000500 	000512 	000524 		.word 500,    512,    524,    536,    550,    562,    574,	0
	000340	000536 	000550 	000562
	000346	000574 	000000
     68					.iif gt .-360	.error ; не влазит !
     69					;----------------------------------------
     70		000400 			.=400
     71	000400	000000G	000000G	000000G	tblreq: .word		initsem,relsem, waitsem
     72	000406	000000G	000000G	000000G		.word	sigsem, setpri, provec, unpvec
	000414	000000G
     73	000416	000000G	000000G	000000G		.word	proreg, unpreg, waitint,newromp
	000424	000000G
     74	000426	000000G	000000G	000000G		.word	setint, resint, free4k ,get4k
	000434	000000G
     75	000436	000000G	000000G	000000G		.word	get8k,	fremem ,putbmap,getbmap
	000444	000000G
     76	000446	000000G	000000G	000000G		.word	getsmap,himpri, newproc,mthlt
	000454	000000G
     77	000456	000000G	000000G	000000G		.word	mfhlt,	kilproc,getpds, putpds
	000464	000000G
     78	000466	000000G	000000G	000000G		.word	getrds, putrds, getpar, putpar
	000474	000000G
     79	000476	000000 				.word	0
     80					;------------------------------------------------
     81	000500				pw.init:
     82	000500	012700 	000120 			mov	#dvtbl,	r0
     83	000504	012001 				mov	(r0)+,	r1
     84	000506				10$:
     85	000506	012005 				mov	(r0)+,	r5
     86	000510	112104 				movb	(r1)+,	r4
     87	000512				15$:
     88	000512	112102 				movb	(r1)+,	r2
     89	000514	010215 				mov	r2,	(r5)
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-2
Common definitions for bios monitor

     90	000516	077403 				sob	r4,	15$
     91	000520	005710 				tst	(r0)
     92	000522	100771 				bmi	10$
     93					;--------------------------------------------------------
     94	000524				m1tst:				;
     95	000524	012700 	000000G			mov	#prc$$$,r0	;
     96	000530	012701 	060000 			mov	#60000,	r1	;
     97	000534	012706 	160000 			mov	#160000,sp	;
     98					;--------------------------------
     99	000540				10$:				;
    100	000540	011011 				mov	(r0),	(r1)	;
    101		000010 			.rept	8.			;
    102						rol	(r1)		;
    103					.endr				;
    104	000562	106111 				rolb	(r1)		;
    105	000564	000311 				swab	(r1)		;
    106	000566	162021 				sub	(r0)+,	(r1)+	;
    107	000570	001020 				bne	99$		;
    108	000572	005701 				tst	r1		;
    109	000574	100361 				bpl	10$		;
    110	000576	162700 	020000 			sub	#20000,	r0	;17766,	r0	;
    111	000602	162701 	020000 			sub	#20000,	r1	;
    112	000606	005715 				tst	(r5)		;
    113	000610	001002 				bne	20$		;
    114	000612	004737 	000000G			call	vdpini		;
    115	000616				20$:				;
    116	000616	004737 	000676 			call	ind		;
    117	000622	022715 	001740 			cmp	#m$siz,	(r5)	; 192kb
    118	000626	103344 				bcc	10$		;
    119	000630	000441 				br	m2tst		;
    120					;--------------------------------
    121	000632				99$:				;
    122	000632	004737 	000000G			call	dbg00		;
    123					;--------------------------------
    124	000636	000000 	000000 	000140 	partbl:	.word	  0,	  0,	140,	200,	240,	300,	0,	0
	000644	000200 	000240 	000300
	000652	000000 	000000
    125	000656	000140 	000200 	000240 		.word	140,	200,	240,	300,	40,	100,	0,	0
	000664	000300 	000040 	000100
	000672	000000 	000000
    126					;--------------------------------
    127	000676				ind:				;
    128	000676					.push	r0		;
    129	000700	011500 				mov	(r5),	r0	;
    130	000702	062700 	000040 			add	#40,	r0	;
    131	000706	010015 				mov	r0,	(r5)	;
    132	000710	072027 	177776 			ash	#-2,	r0
    133	000714	100002 				bpl	10$		;
    134	000716	162700 	163000 			sub	#160000+1536.,r0;
    135	000722				10$:				;
    136	000722	004537 	000000G			jsr	r5,	$$kdc3	;
    137	000726	   112 	   012 			.byte	4.*16.+10., 10.	;
    138	000730					.pop	r0		;
    139	000732	000207 				return			;
    140					;--------------------------------
    141	000734				m2tst:				;
    142	000734	012737 	001074 	100066 		mov	#m2tr4,	v.tr4h	;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-3
Common definitions for bios monitor

    143	000742	012700 	123456 			mov	#123456,r0	;
    144	000746	005002 				clr	r2		;
    145	000750				10$:				;
    146	000750	010221 				mov	r2,	(r1)+	;
    147	000752	010221 				mov	r2,	(r1)+	;
    148	000754	010221 				mov	r2,	(r1)+	;
    149	000756	010221 				mov	r2,	(r1)+	;
    150	000760	005701 				tst	r1		;
    151	000762	100372 				bpl	10$		;
    152	000764	162701 	020000 			sub	#20000,	r1	;
    153	000770	011504 				mov	(r5),	r4	;
    154	000772	004737 	000676 			call	ind		;
    155	000776	032715 	037740 			bit	#37740,	(r5)	;
    156	001002	001434 				beq	m2tr4		;
    157	001004	010011 				mov	r0,	(r1)	;
    158	001006	020011 				cmp	r0,	(r1)	;
    159	001010	001031 				bne	m2tr4		;
    160	001012	005100 				com	r0		;
    161	001014	005111 				com	(r1)		;
    162	001016	020011 				cmp	r0,	(r1)	;
    163	001020	001025 				bne	m2tr4		;
    164	001022	005100 				com	r0		;
    165	001024	032715 	017700 			bit	#17700,	(r5)	;
    166	001030	001412 				beq	96$		;
    167
    168	001032	023737 	000300 	040000 		cmp	vdtbl,	40000	;
    169	001040	001743 				beq	10$		;
    170	001042	012715 	117740 			mov	#117740,(r5)	;
    171	001046	005737 	161204 			tst	hr2		;
    172	001052	001736 				beq	10$		;
    173					;	bis	#40000,r4	;
    174	001054	000407 				br	m2tr4		;
    175	001056				96$:
    176	001056	012737 	020000 	161204 		mov	#20000,	hr2	;
    177	001064	013737 	000300 	040000 		mov	vdtbl,	40000	;
    178	001072	000726 				br	10$		;
    179	001074				m2tr4:				;
    180	001074	010437 	100002 			mov	r4,	maplen	;
    181					;--------------------------------
    182	001100				unp:				;
    183	001100	012700 	000636 			mov	#partbl,r0	;
    184	001104	012701 	161200 			mov	#hr0,	r1	;
    185	001110	012702 	000020 			mov	#16.,	r2	;
    186	001114				10$:				;
    187	001114	012021 				mov	(r0)+,	(r1)+	;
    188	001116	077202 				sob	r2,	10$	;
    189									;
    190					;call dbg00				;
    191	001120	004737 	000000G			call	unpack		;
    192					;call dbg00				;
    193	001124	013700 	040040 			mov	40040,	r0	;
    194	001130					wcpc			;
    195	001132	005000 				clr	r0		;
    196	001134					wcps			;
    197					;call dbg00				;
    198					;--------------------------------
    199	001136				stinit:				;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-4
Common definitions for bios monitor

    200	001136	012701 	161204 			mov	#hr2,	r1	;
    201	001142	005021 				clr	(r1)+		;
    202	001144	005021 				clr	(r1)+		;
    203	001146	013721 	161230 			mov	ur4,	(r1)+	;
    204	001152	013711 	161232 			mov	ur5,	(r1)	;
    205					;--------------------------------
    206	001156	012700 	000400 			mov	#tblreq,r0	;
    207	001162	012701 	154142 			mov	#l.rda+4142,r1	;
    208	001166	012021 			16$:	mov	(r0)+,	(r1)+	;
    209	001170	001376 				bne	16$		;
    210	001172	012706 	140000 			mov	#hstack,sp	;
    211	001176	012737 	137600 	100034 		mov	#hstack-200,top$$
    212									;
    213	001204	012701 	100146 			mov	#vrqtbl, r1	;
    214	001210	010111 				mov	 r1,	(r1)	;
    215	001212	012111 				mov	(r1)+,	(r1)	;
    216									;
    217	001214	012705 	100602 			mov	#heap$$,r5	;
    218	001220	010537 	100014 			mov	r5,	memuse	;
    219
    220	001224	013704 	100002 			mov	maplen,	r4	;
    221	001230	100005 				bpl	19$		;
    222	001232	022704 	117740 			cmp	#117740,r4	;
    223	001236	001002 				bne	19$		;
    224	001240	012704 	003740 			mov	#3740,	r4	;
    225	001244				19$:
    226	001244	010400 				mov	r4,	r0	;
    227	001246	042704 	140000 			bic	#140000,r4	;
    228	001252	072427 	177771 			ash	#-7,	r4	;
    229	001256	005204 				inc	r4		;
    230	001260	010437 	100002 			mov	r4,	maplen	;
    231
    232	001264	060405 				add	r4,	r5	;
    233	001266	010537 	100000 			mov	r5,	heap	;
    234									;
    235	001272	013701 	100014 			mov	memuse, r1	;
    236	001276	010102 				mov	r1,	r2	;
    237	001300	012721 	177400 			mov	#^b1111111100000000,(r1)+	; -8*4k
    238	001304	005744 				tst	-(r4)		;
    239	001306	112721 	177777 		20$:	movb	#-1,	(r1)+	;
    240	001312	077403 				sob	r4,	20$	;
    241
    242	001314	005700 				tst	r0		;
    243	001316	100006 				bpl	22$		;
    244	001320	062702 	000020 			add	#16.,	r2	;
    245	001324	012704 	000060 			mov	#48.,	r4	;
    246	001330				21$:
    247	001330	105022 				clrb	(r2)+		;
    248	001332	077402 				sob	r4,	21$	;
    249
    250	001334				22$:				;
    251	001334	012701 	100022 			mov	#rdsucc,r1	;
    252	001340	010137 	100020 			mov	r1,	readyqu ;READYQU -> RDSUCC
    253	001344	010111 				mov	r1,	(r1)	;RDSUCC  -> RDSUCC
    254	001346	012111 				mov	(r1)+,	(r1)	;RDPRED  -> RDSUCC
    255	001350	012701 	100030 			mov	#tmsucc,r1	;
    256	001354	010137 	100026 			mov	r1,	timeque	;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 4-5
Common definitions for bios monitor

    257	001360	010111 				mov	r1,	(r1)	;
    258	001362	012111 				mov	(r1)+,	(r1)	;
    259									;
    260	001364	062705 	000020 			add	#p.sp,	r5	;
    261	001370	010537 	100016 			mov	r5,	running	;
    262									;
    263	001374	004737 	000000G			call	clkini		;
    264					;call dbg00				;
    265	001400	013703 	100000 			mov	heap,	r3	;
    266	001404					rcpc			;
    267	001406	010005 				mov	r0,	r5	;
    268	001410	000137 	000000G			jmp	newromp		;
    269					;--------------------------------
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 5
Common definitions for bios monitor

      1					;------------------------------------------------
      2	001414	011005 			$$csr:	mov	(r0),	r5	;
      3	001416	062705 	100072 			add	#vrqtbl-v.low+4,r5
      4	001422	032711 	000100 			bit	#100,	(r1)	; l.reg
      5	001426	001002 				bne	10$		;
      6	001430	000137 	000000G			jmp	res.int		;
      7					;................................
      8	001434	105711 			10$:	tstb	(r1)		; l.reg
      9	001436	100002 				bpl	20$		;
     10	001440	000137 	000000G			jmp	set.int		;
     11	001444	000207 			20$:	return			;
     12					;------------------------------------------------
     13	001446				vec.to:
     14	001446	010537 	100052 		    	mov	r5,	sav.r5
     15	001452	010037 	100040 			mov	r0,	sav.r0
     16	001456	013705 	100146 			mov	vrqtbl, r5
     17	001462	012500 				mov	(r5)+,	r0
     18	001464	021500 				cmp	(r5),	r0
     19	001466	001011 				bne	15$
     20	001470	042737 	000010 	100036 		bic	#c.irq,	vrqflg
     21	001476	052737 	000010 	161034 		bis	#c.irq, ppic
     22	001504	022705 	100150 			cmp	#vrqtbl+2,r5
     23	001510	001412 				beq	99$
     24	001512				15$:
     25	001512	010035 				mov	r0,	@(r5)+
     26	001514	014560 	000002 			mov	-(r5),  2(r0)
     27	001520	005045 				clr	-(r5)
     28	001522	162705 	100072 			sub	#vrqtbl-v.low+4,r5
     29	001526					mfus
     30	001530					wcpc
     31	001532					mfus
     32	001534					wcps
     33	001536				99$:
     34	001536	013700 	100040 		        mov	sav.r0,r0
     35	001542	013705 	100052 			mov	sav.r5,r5
     36	001546				 	step
     37					;------------------------------------------------
     38		000010 			        rd = 10			;
     39		000004 			        wr =  4			;
     40		000001 				p.hlt=1			;
     41	001550				vhlt::  			;
     42	001550	010677 	076242 			mov     sp,     @running;
     43	001554	013706 	100016 			mov	running,sp	;
     44	001560					.push	<r5,r4,r3,r2,r1,r0>
     45	001574	010602 				mov	sp,	r2	;
     46	001576	162702 	000004 			sub	#p.r0,	r2	;
     47	001602	012706 	140000 			mov	#hstack,sp	;
     48	001606	005737 	100600 			tst	tcflg		;
     49	001612	001022 				bne	5$		;
     50					;--------------------------------
     51	001614	012703 	161016 			mov	#sndcsr,r3	;
     52	001620	012713 	000264 			mov	#264,	(r3)	;
     53	001624	014301 				mov	-(r3),	r1	;
     54	001626	000301 				swab	r1		;
     55	001630	151301 				bisb	(r3),	r1	;
     56	001632	000301 				swab	r1		;
     57	001634	005401 				neg	r1		;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 5-1
Common definitions for bios monitor

     58	001636	005000 				clr	r0		;
     59	001640	010013 				mov	r0,	(r3)	;
     60	001642	010013 				mov	r0,	(r3)	;
     61	001644	073027 	177773 			ashc	#-5,	r0	;
     62	001650	060137 	100574 			add	r1,	c.tim0	;
     63	001654	005537 	100576 			adc	c.tim1		;
     64					;--------------------------------
     65	001660				5$:				;
     66	001660	013700 	161032 			mov	ppib,	r0	;
     67	001664	052700 	000340 			bis	#340,	r0	;
     68	001670	106400 				mtps	r0		;
     69	001672	102033 				bvc	write		;
     70	001674	103002 				bcc	read		;
     71	001676	001513 				beq	ioint		;
     72	001700	000550 				br	hlt		;
     73					;------------------------------------------------
     74	001702				read:				;
     75	001702	013701 	161202 			mov	hr1,	r1	;
     76	001706	001412 				beq	100$		;
     77	001710	016100 	160000 			mov	-20000(r1),r0	; l.rda
     78	001714	001526 				beq	trap4.		;
     79	001716	100006 				bpl	100$		;
     80	001720	062700 	000004 			add	#4,	r0	;
     81	001724	112710 	000010 			movb	#rd,	(r0)	;
     82	001730	004737 	002672 			call	$$put1		;
     83					;................................
     84	001734	013701 	161200 		100$:	mov	hr0,	r1	;
     85	001740	016100 	160000 			mov	-20000(r1),r0	; l.rda
     86	001744	001512 				beq	trap4.		;
     87	001746	100063 				bpl	h.int		;
     88	001750	062700 	000004 			add	#4,	r0	;
     89	001754	112710 	000010 			movb	#rd,	(r0)	;
     90	001760	000431 				br	$$put0		;
     91					;----------------------------------------
     92	001762	013701 	161202 		write:	mov	hr1,	r1	;
     93	001766	001413 				beq	10$		;
     94	001770	042701 	030000 		        bic     #30000,	r1	; l.reg
     95	001774	016100 	010000 			mov	10000(r1),r0	; l.rda
     96	002000	100074 				bpl	jrq		;
     97	002002	042011 			     	bic	(r0)+,	(r1)	; l.reg
     98	002004	052011 				bis	(r0)+,	(r1)	;
     99	002006	112710 	000014 			movb	#wr+rd,	(r0)	;
    100	002012	004737 	002672 			call	$$put1		;
    101					;................................
    102	002016	013701 	161200 		10$:	mov	hr0,	r1	;
    103	002022	042701 	030000 		        bic     #30000,	r1	; l.reg
    104	002026	016100 	010000 			mov	10000(r1),r0	; l.rda
    105	002032	100057 				bpl	jrq		;
    106	002034	042011 			     	bic	(r0)+,	(r1)	;
    107	002036	052011 				bis	(r0)+,	(r1)	;
    108	002040	112710 	000014 			movb	#wr+rd, (r0)	;
    109					;------------------------------------------------
    110	002044				$$put0:				;
    111	002044	132010 				bitb	(r0)+,	(r0)	;
    112	002046	001423 				beq	h.int		;
    113	002050	132720 	000001 			bitb	#p.hlt, (r0)+	;
    114	002054	001403 				beq	10$		;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 5-2
Common definitions for bios monitor

    115	002056	012746 	002116 			mov	#h.int,	-(sp)	;
    116	002062	012007 				mov	(r0)+,	pc	; call hlt-process
    117	002064				10$:				;
    118	002064	012003 				mov	(r0)+,	r3	;
    119	002066	032763 	040000 	000046 		bit	#m.run,	p.mask(r3)
    120	002074	001010 				bne	h.int		;
    121	002076	012063 	000004 			mov	(r0)+,	p.r0(r3)
    122	002102	010263 	000050 			mov	r2,	p.cprc(r3)
    123	002106	013701 	100020 			mov	readyq,	r1	;
    124	002112	004737 	000000G			call	putpri		;
    125					;------------------------------------------------
    126	002116				h.int:				;
    127	002116	032737 	000004 	161032 		bit	#4,	ppib	;
    128	002124	001505 				beq	schedule	;
    129	002126	012701 	161000 		ioint:	mov	#piccsr,r1	;
    130	002132	012711 	000014 			mov	#14,    (r1)	;
    131	002136	005000 				clr	r0		;
    132	002140	151100 				bisb	(r1),   r0	;
    133	002142	106300 				aslb	r0		;
    134	002144	103075 				bcc     schedule	;
    135									;
    136	002146	012721 	000040 		 	mov	#40,	(r1)+   ;eoi
    137	002152	106300 			        aslb	r0		;
    138	002154	062700 	100106 			add	#v.init,r0	;
    139	002160	012003 			int4:	mov	(r0)+,	r3	;+2
    140	002162	001440 				beq	supr		;
    141	002164	100445 			int5:	bmi	int10		;
    142	002166	004713 				call	(r3)		; call hlt-process
    143	002170	000463 				br	schedule	;
    144					;................................
    145	002172				jrq:				;
    146	002172	001560 			trap4.:	beq	trap4		;
    147	002174	010203 				mov	r2,	r3	;
    148	002176	010002 				mov	r0,	r2	;
    149	002200	011105 				mov	(r1),	r5	; l.reg
    150	002202					rcps			;
    151	002204	006000 				ror	r0		;
    152	002206	006300 				asl	r0		;
    153	002210					wcps			;
    154	002212	000112 				jmp	(r2)		;
    155					;................................
    156	002214	012700 	100066 		tr4h:	mov	#v.tr4h,r0	;
    157	002220	000757 				br	int4		;
    158					;................................
    159	002222				hlt:	;bit	#10, ppib	; bit	#i.hlt, ppip
    160	002222	100012 				bpl	5$		; bne	5$
    161	002224					rcpc			;
    162	002226	010005 				mov	r0,	r5	;
    163	002230	162705 	000002 			sub	#2,  	r5	;
    164	002234					mfus			;
    165	002236	005700 				tst	r0		;
    166	002240	001153 				bne	exit		;
    167									;
    168	002242	012700 	100062 			mov	#v.cpuh,r0	;
    169	002246	000744 				br	int4		;
    170	002250	012700 	100072 		5$: 	mov	#v.but, r0	;
    171	002254	042737 	000004 	100036 		bic	#c.hlt,	vrqflg	;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 5-3
Common definitions for bios monitor

    172	002262	000736 				br	int4		;
    173	002264				supr:				;
    174	002264	012700 	100076 		     	mov	#v.supr,r0	;
    175	002270	012003 				mov	(r0)+,	r3	;
    176	002272	001334 				bne	int5		;
    177	002274	000137 	000000G			jmp	dbg		;
    178					;................................
    179	002300				int10:				;
    180	002300	056337 	000046 	161002 		bis	p.mask(r3),picmr;
    181	002306	032763 	040000 	000046 		bit	#m.run,	p.mask(r3)
    182	002314	001011 				bne	schedule	;
    183	002316	011063 	000010 			mov	(r0),   p.r2(r3);
    184	002322	052763 	000001 	000024 		bis	#1,	p.ps(r3);
    185					;------------------------------------------------
    186	002330				put.sche::			;
    187	002330	013701 	100020 			mov	readyq, r1	;
    188	002334	004737 	000000G			call	putpri		;
    189	002340				schedule::			;
    190	002340	013706 	100016 		 	mov	running,sp	;
    191	002344	013701 	100022 			mov	rdsucc, r1	;
    192	002350	062701 	000020 			add     #p.sp,r1	;
    193	002354	020601 				cmp	sp,	r1	;
    194	002356	001504 				beq	exit		;
    195									;
    196	002360	063766 	100574 	000060 		add	c.tim0,	p.tim0-p.sp(sp)
    197	002366	005566 	000062 			adc		p.tim1-p.sp(sp)
    198	002372	063766 	100576 	000062 		add	c.tim1,	p.tim1-p.sp(sp)
    199									;
    200	002400	163761 	100574 	000060 		sub	c.tim0,	p.tim0-p.sp(r1)
    201	002406	005661 	000062 			sbc		p.tim1-p.sp(r1)
    202	002412	163761 	100576 	000062 		sub	c.tim1,	p.tim1-p.sp(r1)
    203									;
    204	002420	005726 				tst	(sp)+		;
    205	002422					rcpc			;
    206	002424	010026 				mov	r0,	(sp)+	;
    207	002426				        rcps			;
    208	002430	010026 			        mov     r0,     (sp)+	;
    209	002432	012702 	161220 		        mov     #ur0,   r2	;
    210	002436	012226 			        mov     (r2)+,  (sp)+   ;ur0
    211	002440	012226 			        mov     (r2)+,  (sp)+	;
    212	002442	012226 			        mov     (r2)+,  (sp)+	;
    213	002444	012226 			        mov     (r2)+,  (sp)+	;
    214	002446	012226 			        mov     (r2)+,  (sp)+	;
    215	002450	012226 			        mov     (r2)+,  (sp)+	;
    216	002452	012226 			        mov     (r2)+,  (sp)+	;
    217	002454	011216 			        mov     (r2),   (sp)    ;ur7
    218	002456	010137 	100016 			mov	r1,	running	;
    219	002462	062701 	000026 			add	#p.mask-p.sp,r1	;
    220	002466	051137 	161002 			bis	(r1),   picmr	;
    221	002472	052711 	040000 			bis	#m.run,	(r1)	;
    222	002476	014112 			     	mov	-(r1),	(r2)	;ur7
    223	002500	014142 				mov	-(r1),	-(r2)	;
    224	002502	014142 				mov	-(r1),	-(r2)	;
    225	002504	014142 				mov	-(r1),	-(r2)	;
    226	002506	014142 				mov	-(r1),	-(r2)	;
    227	002510	014142 				mov	-(r1),	-(r2)	;
    228	002512	014142 				mov	-(r1),	-(r2)	;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 5-4
Common definitions for bios monitor

    229	002514	014142 				mov	-(r1),	-(r2)	;ur0
    230	002516	014100 			        mov     -(r1),  r0	;ps
    231	002520				        wcps			;
    232	002522	014100 				mov	-(r1),	r0	;pc
    233	002524					wcpc			;
    234									;
    235	002526	014106 				mov	-(r1),	sp	;sp
    236	002530	010100 				mov	r1,	r0	;
    237	002532	000421 				br	ex10		;
    238					;------------------------------------------------
    239	002534	017705 	075256 		trap4:	mov	@running,r5	;
    240	002540					rcps			;
    241	002542					mtus			;
    242	002544					rcpc			;
    243	002546					mtus			;
    244	002550	010577 	075242 			mov	r5,	@running;
    245	002554	012705 	000004 			mov	#4,	r5	;
    246	002560					mfus			;
    247	002562					wcpc			;
    248	002564					mfus			;
    249	002566					wcps			;
    250					;------------------------------------------------
    251	002570				exit::				;
    252	002570	013700 	100016 		      	mov     running,r0	;
    253	002574	011006 				mov	(r0),	sp	;
    254	002576	014005 			ex10:	mov	-(r0),	r5	;
    255	002600	014004 				mov	-(r0),	r4	;
    256	002602	014003 				mov	-(r0),	r3	;
    257	002604	014002 				mov	-(r0),	r2	;
    258	002606	013701 	161034 			mov	ppic,	r1	;
    259	002612	052701 	000014 			bis	#c.irq+c.hlt,r1	;
    260	002616	043701 	100036 			bic	vrqflg, r1	;
    261	002622	005760 	000036 			tst	p.mask-p.r2(r0)	; m.irq
    262	002626	100402 				bmi	10$		;
    263	002630	052701 	000010 			bis	#c.irq, r1	;
    264	002634				10$:				;
    265	002634	032760 	020000 	000036 		bit	#20000,p.mask-p.r2(r0)	; m.hlt
    266	002642	001002 				bne	20$		;
    267	002644	052701 	000004 			bis	#c.hlt,	r1	;
    268	002650				20$:				;
    269	002650	010137 	161034 			mov	r1,	ppic	;
    270	002654	014001 				mov	-(r0),	r1	;
    271	002656	014000 			  	mov	-(r0),	r0	;
    272	002660	005037 	161200 			clr	hr0		;
    273	002664	005037 	161202 			clr	hr1		;
    274	002670					step			;
    275					;------------------------------------------------
    276	002672				$$put1:				;
    277	002672	132010 				bitb	(r0)+,	(r0)	;
    278	002674	001421 				beq	99$		;
    279	002676	132720 	000001 			bitb	#p.hlt, (r0)+	;
    280	002702	001401 				beq	10$		;
    281	002704	012007 				mov	(r0)+,	pc	; call hlt-process
    282	002706				10$:				;
    283	002706	012003 				mov	(r0)+,	r3	;
    284	002710	032763 	040000 	000046 		bit	#m.run,	p.mask(r3)
    285	002716	001010 				bne	99$		;
.MAIN.	MACRO V05.06R Friday 30-Nov-18 09:49  Page 5-5
Common definitions for bios monitor

    286	002720	012063 	000006 			mov	(r0)+,	p.r1(r3);
    287	002724	010263 	000050 			mov	r2,	p.cprc(r3)
    288	002730	013701 	100020 			mov	readyq,	r1	;
    289	002734	000137 	000000G			jmp	putpri		;
    290	002740	000207 			99$:	return			;
    291					;------------------------------------------------
    292
    293		000001 			.end
Errors detected:  0

*** Assembler statistics


Work  file  reads: 0
Work  file writes: 0
Size of work file: 9808 Words  ( 39 Pages)
Size of core pool: 15872 Words  ( 62 Pages)
Operating  system: RT-11

Elapsed time: 00:00:00.10
DK:P16HLT,DK:P16HLT=DK:P16,DK:P16INI,DK:P16HLT

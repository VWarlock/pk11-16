.MAIN.	MACRO V05.06R Wednesday 28-Nov-18 10:57
Table of contents

    2- 462	common definitions for bios monitor
    5-   1	common definitions for WINDOW-monitor
.MAIN.	MACRO V05.06R Wednesday 28-Nov-18 10:57  Page 1


      1					.enabl  lc
      2					.enabl	ama
      3					.enabl  gbl
      4					.mcall	.push,.pop
.MAIN.	MACRO V05.06R Wednesday 28-Nov-18 10:57  Page 6
Common definitions for WINDOW-monitor

      2	000000				.asect
      3		000004 			.=4
      4	000004	000014 	000001 			.word	trrr, 1
      5	000010	000014 	000002 			.word	trrr, 2
      6	000014	106766 	000002 		trrr:	mfps	2(sp)
      7	000020	000002 				rti
      8		000110 			.=110
      9	000110	   117 	   160 	   145 		.asciz	/Operating system/
	000113	   162 	   141 	   164
	000116	   151 	   156 	   147
	000121	   040 	   163 	   171
	000124	   163 	   164 	   145
	000127	   155 	   000
     10		000140 			.=140
     11	000140	177776 	010000 			.word	-2, 10000
     12		000200 			.=200
     13	000200	041113 	000000G			.word	"KB, t$tbl 	;
     14	000000				.psect
     15					;----------------------------------------
     16	000000				ROMBOOT:			;
     17	000000					SETPRI	#3		;
     18	000010	012702 	001016'			mov	#str,	r2	;
     19	000014	010706 				mov	pc,	sp	;
     20	000016	004737 	001002'			call	wname		;
     21					;................................
     22	000022	005000 				clr	r0		;
     23	000024	012702 	020000 			mov	#20000,	r2	;
     24	000030				5$:				;
     25	000030	066000 	000050 			add	50(r0),	r0	; romboot top
     26	000034	062700 	000777 			add	#777,	r0	;
     27	000040	042700 	000777 			bic	#777,	r0	;
     28	000044	012701 	100000 			mov	#100000,r1	;
     29	000050	060100 				add	r1,	r0	;
     30	000052	160200 				sub	r2,	r0	;
     31	000054				10$:				;
     32	000054	014041 				mov	-(r0),	-(r1)	;
     33	000056	020201 				cmp	r2,	r1	;
     34	000060	001375 				bne	10$		;
     35	000062	010200 				mov	r2,	r0	;
     36	000064	060202 				add	r2,	r2	;
     37	000066	005127 	000000 			com	#0		;
     38	000072	001356 				bne	5$		;
     39					;................................
     40	000074					NEWROM	#RSTINI		;
     41	000104					NEWROM	#KBEINI		;
     42	000114					NEWROM	#hdcini		;
     43					;--------------------------------
     44	000124	012702 	020040 			mov	#20040,	r2	;
     45	000130	012703 	000002 			mov	#2,	r3	;
     46	000134	004737 	000640'			call	creproc		;
     47	000140	012702 	040040 			mov	#40040,	r2	;
     48	000144	012703 	000004 			mov	#4,	r3	;
     49	000150	004737 	000640'			call	creproc		;
     50					;----------------------------------------
     51	000154				boot00:				; RT
     52	000154	012702 	000140 			mov	#140,	r2	;
     53	000160	012703 	000016 			mov	#14.,	r3	;
.MAIN.	MACRO V05.06R Wednesday 28-Nov-18 10:57  Page 6-1
Common definitions for WINDOW-monitor

     54	000164	004737 	000640'			call	creproc		;
     55	000170					SETPRI	#1		;
     56					;................................
     57	000200	012700 	000524'			mov	#vdarea,r0	;
     58	000204					ARCRE			;
     59	000212	013737 	000526'	000620'		mov	vdarea+2,vdvw+4	;
     60	000220	012700 	000614'			mov	#vdvw,	r0	;
     61	000224					VWCRE			;
     62					;................................
     63	000232	013737 	000444'	161226 		mov	desc+p.ur0, ur3	;
     64					;-------------------------------- READ	#60000(BUF), #256.(WCN), #0(BLK)
     65	000240				boot:				;
     66	000240	005737 	157130 			tst	@#157130	; hard-disk ready ?
     67	000244	001775 				beq	boot		;
     68	000246	012700 	000411'			mov	#170$+3,r0	;
     69	000252	012701 	177130 			mov	#177130,r1	; hdcsr
     70	000256	112710 	000010 			movb	#10,	(r0)	; dev.num
     71	000262				15$:				;
     72					;................................
     73	000262	005227 				inc	(pc)+		;
     74	000264	177777 			17$:	.word	-1		;
     75	000266	001002 				bne	20$		;
     76	000270	111127 				movb	(r1),	(pc)+	;
     77	000272	000000 			18$:	.word	0		;
     78					;................................
     79	000274				20$:				;
     80	000274	122710 	000012 			cmpb	#12,	(r0)	;
     81	000300	001011 				bne	40$		;
     82	000302	113710 	000272'			movb	18$,	(r0)	;
     83	000306	100004 				bpl	30$		;
     84	000310	111110 				movb	(r1),	(r0)	;
     85	000312	106010 				rorb	(r0)		;
     86	000314	106010 				rorb	(r0)		;
     87	000316	106010 				rorb	(r0)		;
     88	000320				30$:				;
     89	000320	042710 	174000 			bic	#^c7*400,(r0)	;
     90					;................................
     91	000324				40$:				;
     92	000324	012711 	000406'			mov	#170$,	(r1)	;
     93	000330	000240 				nop			;
     94	000332				50$:				;
     95	000332	105711 				tstb	(r1)		;
     96	000334	100376 				bpl	50$		;
     97	000336	032711 	177400 			bit	#177400,(r1)	;
     98	000342	001405 				beq	120$		;
     99	000344	132710 	000010 			bitb	#10,	(r0)	;
    100	000350	001733 				beq	boot		;
    101	000352	105210 				incb	(r0)		;
    102	000354	000742 				br	15$		;
    103					;--------------------------------
    104	000356				120$:				;
    105	000356	112737 	177777 	000272'		movb	#-1,	18$	;
    106	000364					SETPRI	#-12345		;
    107	000374					SETPRI	#1		;
    108	000404	000663 				br	boot00		;
    109					;--------------------------------------------------
    110	000406	000000 	000000 	060000 	170$:	.word	0, 0, 60000, 400; area for read-disk request
.MAIN.	MACRO V05.06R Wednesday 28-Nov-18 10:57  Page 6-2
Common definitions for WINDOW-monitor

	000414	000400
    111	000416				desc:	.blkb	prolen		; area for descriptor
    112	000524	000000 	000000 	000014 	vdarea:	.word	0,	0,	12.,	40.
	000532	000050
    113		143150 			..xx=142400+360.
    114	000534	143150 	000000 			.word	..xx,	vm1+pl0 ; 1
    115	000540	143150 	000000 			.word	..xx,	vm1+pl0 ; 2
    116		142400 			..x=142400
    117	000544	142400 	000000 			.word	..x,	vm1+pl0 ; 3
    118		142450 			..x=..x+40.
    119	000550	142450 	000000 			.word	..x,	vm1+pl0 ; 4
    120		142520 			..x=..x+40.
    121	000554	142520 	000000 			.word	..x,	vm1+pl0 ; 5
    122	000560	142520 	000000 			.word	..x,	vm1+pl0 ; 6
    123		142570 			..x=..x+40.
    124	000564	142570 	000000 			.word	..x,	vm1+pl0 ; 7
    125		142640 			..x=..x+40.
    126	000570	142640 	000000 			.word	..x,	vm1+pl0 ; 8
    127		142710 			..x=..x+40.
    128	000574	142710 	000000 			.word	..x,	vm1+pl0 ; 9
    129	000600	142710 	000000 			.word	..x,	vm1+pl0 ;10
    130		142760 			..x=..x+40.
    131	000604	142760 	000000 			.word	..x,	vm1+pl0 ;11
    132
    133	000610	143150 	000000 			.word	..xx,	vm1+pl0 ;12
    134	000614	000004 	000000 	000000 	vdvw:	.word	vwcre,0,0,0,0,8.,300,17.,30.,1001
	000622	000000 	000000 	000010
	000630	000300 	000021 	000036
	000636	001001
    135					;vdvw:	.word	vwcre,0,0,0,0,14.,300,17.,30.,1001
    136					;--------------------------------------------------
    137	000640				creproc:			;
    138	000640	012700 	000524'			mov	#desc+prolen,r0	;
    139	000644	012701 	000043 			mov	#prolen/2,r1	;
    140	000650				10$:				;
    141	000650	005040 				clr	-(r0)		;
    142	000652	077102 				sob	r1,	10$	;
    143					;................................
    144	000654	062712 	000002 			add	#2,	(r2)	;
    145	000660	001403 				beq	15$		;
    146	000662	012737 	000002 	000472'		mov	#2,   desc+p.pri;
    147	000670				15$:				;
    148	000670	012237 	000440'			mov	(r2)+,desc+p.pc ; PC+2
    149	000674	001003 				bne	16$		;
    150	000676	012737 	120000 	000464'		mov	#120000,desc+p.mask	;m.irq+m.hlt
    151	000704				16$:				;
    152	000704	011237 	000436'			mov	(r2), desc+p.sp ; SP
    153					;................................
    154	000710	062702 	177746 			add	#10-42,	r2	;
    155	000714	004737 	001002'			call	wname		;
    156					;................................
    157	000720					GET4K	r3		;
    158	000726	006203 				asr	r3		;
    159	000730	012701 	000444'			mov	#desc+p.ur0, r1	;
    160	000734				30$:				;
    161	000734	010021 				mov	r0,	(r1)+	;
    162	000736	062700 	000040 			add	#40,	r0	;
.MAIN.	MACRO V05.06R Wednesday 28-Nov-18 10:57  Page 6-3
Common definitions for WINDOW-monitor

    163	000742	077304 				sob	r3,	30$	;
    164					;--------------------------------
    165	000744	013700 	100016 			mov	runnin,	r0	;
    166	000750	016000 	000036 			mov	p.mem-p.sp(r0), r0
    167	000754	010001 				mov	r0,	r1	;
    168	000756					NEWPROC	#desc		;
    169	000766	013702 	100002 			mov	maplen,	r2	;
    170	000772				40$:				;
    171	000772	112721 	177777 			movb	#-1,	(r1)+	;
    172	000776	077203 				sob	r2,	40$	;
    173	001000	000207 				return			;
    174					;--------------------------------
    175	001002				wname::
    176	001002	010001 				mov	r0,	r1
    177	001004	062701 	000060 			add	#p.name,r1
    178	001010				10$:
    179	001010	112221 				movb	(r2)+,	(r1)+
    180	001012	001376 				bne	10$
    181	001014	000207 				return
    182	001016	   122 	   117 	   115 	str:	.asciz	/ROM-proc loader /
	001021	   055 	   160 	   162
	001024	   157 	   143 	   040
	001027	   154 	   157 	   141
	001032	   144 	   145 	   162
	001035	   040 	   000
    183		000000'			.end romboot
Errors detected:  0

*** Assembler statistics


Work  file  reads: 0
Work  file writes: 0
Size of work file: 11088 Words  ( 44 Pages)
Size of core pool: 16384 Words  ( 64 Pages)
Operating  system: RT-11

Elapsed time: 00:00:00.12
DK:P16BOT,DK:P16BOT=DK:P16,DK:P16BOT


                      9. Консоль─пульт
							  12.09.90

     Консоль─пульт  представляет   собой   процесс,   использующий 
средства оконной подсистемы  ВПО  и  предназначен  для  выполнения 
различных служебных функций, в том числе:

─ прерывание выполнения программ по нажатию клавиши "СТОП";
─ просмотр (модификацию) содержимого памяти, регистров и т.п.;
─ переключение с "контекста" одного процесса на другой;
─ "теплая" перезагрузка ОС с устройств HD:, FD:, MD:.
─ программирование   комбинации   клавиш   "УПР"+"ФИКС"+"ЗАБОЙ" на
  перезапуск всего встроенного ПО ("холодный" перезапуск);
─ реализация "запроса" KILHIM  ─  завершение  работы  процесса	(с
  удалением его из памяти).

     При своей работе Пульт использует два эмулируемых регистра:

CNSBUF (174052)     буферный регистр, используемый  для  получения
                    кодов, нажимаемых клавиш;
CNSKIL (174054)     регистр, используемый для  выполнения  запроса
                    на завершение работы процесса.

     Пульт получает управление в двух ситуациях:

а) при нажатии клавиши "СТОП"
б) при выполнении одним из процессов инструкции процессора HALT

     После получения управления Пульт создает  "окно",  в  котором 
высвечивается следующая информация:
┌───────────────────────────────────────┐
│Пульт V1.0	      . 000000 <─ 000000│├─ поле операции записи
│UR0═07440 UR1═07500 UR2═07540 UR3═07600│┐
│UR4═07640 UR5═07700 UR6═07740 UR7═00000│┴ поле регистров диспетчера
│101722 Operating system #07   PSW═00010│├─ поле идентификации
│R0═000000 R1═000000 R2═000000 R3═000000│┐
│R4═000000 R5═000000 R6═000000 R7═000000│┴ поле регистров процессора
│000000Ж  000000  000000  000000  000000│┐
│000000Ж  000000  000000  000000  000000││
│000000Ж  000000  000000  000000  000000│├─ основное поле
│000000Ж  000000  000000  000000  000000│┘
│					│
│000000 / 000000			│├ поле режимов адресации
└───────────────────────────────────────┘
 └─────┬────────┘
    поле редактирования

Поле идентификации содержит  идентификацию  прерванного  процесса: 
адрес его дескриптора,  имя  и  номер;  а  также  слово  состояние 
процессора в момент прерывания.

Поле операции  записи  содержит  адрес,  по  которому  может  быть 
выполнена операция записи, а также  аргумент  (значение),  который 
будет занесен по адресу, при выполнении команды "запись".

Поле регистров  процессора  содержит  текущие  значения  регистров 
процессора для процесса, индицируемого в поле идентификации.

Основное  информационное  поле  предназначено  для   индикации   в 
экранном режиме содержимого ячеек памяти, эмулируемых регистров  и 
т.п.   из    адресного    пространства    прерванного    процесса. 
Информационное поле может индицироваться в виде слов (восьмеричное 
содержимое), байт (восьмеричное содержимое или текст).

Поле режимов адресации  высвечивается  по  специальной  команде  и 
содержит адреса и значения ячеек  (относительно  текущей  открытой 
ячейки) для следующих режимов адресации:
     br   ─ содержимое текущей ячейки (младший байт)  используется
в качестве смещения  в  инструкциях  ик;  высвечивается  возможный 
адрес перехода и содержимое ячейки по этому адресу;
     _    ─  относительная  адресация  (режим  67);  высвечивается 
адрес ячейки и ее содержимое;
     @	  ─  косвенная	адресация;  содержимое	текущей   открытой
ячейки используется в качестве высвечиваемого адреса  и  значения; 
содержимое  ячейки  используется  в  качестве  нового  адреса,   и 
содержимое новой ячейки также высвечивается.

Поле редактирования имеет следующий формат:

     000000 / 000000
или
     Rn / 000000

где перед "/" высвечивается  адрес  текущей  открытой  ячейки  или
регистра  центрального	 процессора;   после   "/"   высвечивается
содержимое этой ячейки или регистра.
     Ввод нового числового значения (восьмеричного)  высвечивается 
за содержимым ячейки и может редактироваться клавишей "ЗАБОЙ".

К о м а н д ы :

     Все команды для  Пульта  набираются  на  клавиатуре  и  имеют 
следующший формат:
     n X  где n ─ необязательный числовой  аргумент  (восьмеричное
число), а X ─ одна из клавиш, определяющая команду.

Команды переключения активного поля индикации:
┌────┐
│Regs│	  ─ делает активным поле регистров процессора
├────┤
│Dump│	  ─ делает активным основное информационное поле
└────┘
     Команды R и D переключают пульт с режима  просмотраемодифика─
ции ячеек на  режим  просмотраемодификации  регистров  процессора. 
Режим  R   является   вспомогательным:	 в   этом   режиме   можно
использовать только команды, связанные с просмотром и модификацией 
значений,  находящихся  в  регистрах  процессора.  Все   остальные 
команды будут игнорироваться.

Команды переключения адресного пространства:
┌────┐
│User│	  ─ переключиться на адресное пространство User
├────┤
│Halt│	  ─ переключиться на адресное пространство Halt
└────┘
     Обычно работа с пультом происходит в решиме User. При этом  в
основном информационном поле высвечивается информация из адресного 
пространства процесса, индицируемого в поле  идентификации.  После 
переключения в режим Halt в  основном  информационном  поле  можно
просматривать содержимое управляющих структур и данных  диспетчера 
ВПО.

Команды переключения режима вывода основного информационного поля:
┌─────┐
│Words│   ─ 16─разрядные слова в восьмеричном виде
├─────┤
│Bytes│   ─ 8─разрядные байты в восьмеричном виде
├─────┤
│Ascii│   ─ 8─разрядные байты в текстовом виде
└─────┘

Команды переключения процессов:
┌──────┐
│ФИКС+↓│  ─ переключиться на следующий процесс
├──────┤
│ФИКС+↑│  ─ переключиться на предыдущий процесс
└──────┘

Команды выхода:
┌─────┐
│n G  │   ─ выйти из пульта и продолжить процесс с указанного адреса
├─────┤
│ AP2 │   ─ выйти из пульта и продолжить процесс с прерванного места
├─────┤
│n AP2│   ─ поставить останов по указанному адресу и продолжить
└─────┘     процесс с прерванного места

Команды записи по указателю:
┌────┐
│n . │	  ─ задать указатель (адрес, по которому будет запись)
├────┤
│n xx│	  ─ записать значение по указателю
└────┘

     Данные команды позволяют выполнять пультом операции записи  в 
регистры внешних устройств без  выполнения  чтения.  Адрес  записи 
(значение указателя) и значение, которое будет  записано  (если  в 
команде записи не указан числовой аргумент) высвечиваются  в  поле 
операции записи.

Команды просмотра/модификации:
┌──────┐
│   ↓  │
│n ← → │  ─ перейти к следующей ячейке (регистру)
│   ↑  │
└──────┘
     Если указан аргумент  n,  то  в  предыдущую  открытую  ячейку
занести указанное значение.


Команда занесения значения:
┌─────┐
│n ВК │   ─ занести значение n в текущую открытую ячейку
└─────┘

Команды перехода к другой ячейки:
┌────┐
│n / │	  ─ открыть ячейку по адресу n
├────┤
│n @ │	  ─ открыть ячейку по адресу, содержащемуся в ячейке n
├────┤
│n _ │	  ─ открыть ячейку по адресу, содержащемуся в n с учетом
└────┘	    относительного режима адресации (67)

Команда вывода поля режимов адресации:
┌────┐
│Show│	  ─ обновить поле режимов адресации с учетом текущей ячейки
└────┘

Команды перезагрузки дисковой ОС:
┌───┐
│K1 │	  ─ перезагрузиться с устройства MD: (электронный диск)
├───┤
│K2 │	  ─ перезагрузиться с устройства FD: (НГМД)
├───┤
│K3 │	  ─ перезагрузиться с устройства HD: (НЖМД)
└───┘

Запрос удаления процесса

     Пульт содержит  регистр,  обращение  к  которому  со  стороны 
других процессов приводит к  удалению  процесса.  Удалить  процесс 
можно  по  адресу  его  дескриптора  или  по  его  номеру.  Способ 
использования запроса должен быть понятен из примера:

	  ...
CNSKIL	  ═ 174054
.macro	  KILHIM    arg
     mov  arg, @#CNSKIL
     nop
.endm
	  ...
	  KILHIM    #PN       ; PN ─ номер процесса
	  ...
	  KILHIM    #PADR     ; PADR ─ адрес дескриптора процесса
	  ...
